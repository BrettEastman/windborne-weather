import"../chunks/DsnmJJEf.js";import"../chunks/B8C68kId.js";import{w as Ie,o as Be,b as Le,a as ne,e as J}from"../chunks/CBWahqQq.js";import{i as Ce,j as k,k as Pe,g as u,X as Y,l as Oe,H as Re,s as ge,m as he,n as le,x as te,ab as Fe,ac as ke,p as fe,t as He,q as Ue,ad as qe,o as ze,z as Ae,ae as pe,af as Ne,ag as Ve,ah as We,v as Me,w as Ge,ai as Ye,aj as Ke,ak as oe,al as Ee,am as Xe,an as je,ao as Je,ap as Ze,_ as Qe,aq as et,ar as tt,as as at,at as st,D as rt,F as ve,G as _e,I as Z,J as U,K as nt,L as P,au as lt,N as q,M as O,av as ot,O as it,aw as se,a9 as ct,ax as ut,B as me,ay as ft}from"../chunks/CGfr7eec.js";import{i as ye,s as dt,a as xe}from"../chunks/BZrhSzSA.js";import{i as vt}from"../chunks/OLJYdZL9.js";function ie(a,t){return t}function gt(a,t,e){for(var r=a.items,i=[],g=t.length,n=0;n<g;n++)je(t[n].e,i,!0);var o=g>0&&i.length===0&&e!==null;if(o){var s=e.parentNode;Je(s),s.append(e),r.clear(),F(a,t[0].prev,t[g-1].next)}Ze(i,()=>{for(var m=0;m<g;m++){var v=t[m];o||(r.delete(v.k),F(a,v.prev,v.next)),Ee(v.e,!o)}})}function ce(a,t,e,r,i,g=null){var n=a,o={flags:t,items:new Map,first:null};k&&Pe();var s=null,m=!1,v=new Map,$=Y(()=>{var c=e();return Ve(c)?c:c==null?[]:Ne(c)}),l,x;function d(){ht(x,l,o,v,n,i,t,r,e),g!==null&&(l.length===0?s?Me(s):s=fe(()=>g(n)):s!==null&&Ge(s,()=>{s=null}))}Ce(()=>{x??=Qe,l=u($);var c=l.length;if(m&&c===0)return;m=c===0;let S=!1;if(k){var M=Oe(n)===Re;M!==(c===0)&&(n=ge(),he(n),le(!1),S=!0)}if(k){for(var y=null,h,_=0;_<c;_++){if(te.nodeType===Fe&&te.data===ke){n=te,S=!0,le(!1);break}var w=l[_],I=r(w,_);h=de(te,o,y,null,w,I,_,i,t,e),o.items.set(I,h),y=h}c>0&&he(ge())}if(k)c===0&&g&&(s=fe(()=>g(n)));else if(He()){var z=new Set,B=Ue;for(_=0;_<c;_+=1){w=l[_],I=r(w,_);var E=o.items.get(I)??v.get(I);E?Te(E,w,_):(h=de(null,o,null,null,w,I,_,i,t,e,!0),v.set(I,h)),z.add(I)}for(const[V,W]of o.items)z.has(V)||B.skipped_effects.add(W.e);B.add_callback(d)}else d();S&&le(!0),u($)}),k&&(n=te)}function ht(a,t,e,r,i,g,n,o,s){var m=t.length,v=e.items,$=e.first,l=$,x,d=null,c=[],S=[],M,y,h,_;for(_=0;_<m;_+=1){if(M=t[_],y=o(M,_),h=v.get(y),h===void 0){var w=r.get(y);if(w!==void 0){r.delete(y),v.set(y,w);var I=d?d.next:l;F(e,d,w),F(e,w,I),ue(w,I,i),d=w}else{var z=l?l.e.nodes_start:i;d=de(z,e,d,d===null?e.first:d.next,M,y,_,g,n,s)}v.set(y,d),c=[],S=[],l=d.next;continue}if(Te(h,M,_),(h.e.f&oe)!==0&&Me(h.e),h!==l){if(x!==void 0&&x.has(h)){if(c.length<S.length){var B=S[0],E;d=B.prev;var V=c[0],W=c[c.length-1];for(E=0;E<c.length;E+=1)ue(c[E],B,i);for(E=0;E<S.length;E+=1)x.delete(S[E]);F(e,V.prev,W.next),F(e,d,V),F(e,W,B),l=B,d=W,_-=1,c=[],S=[]}else x.delete(h),ue(h,l,i),F(e,h.prev,h.next),F(e,h,d===null?e.first:d.next),F(e,d,h),d=h;continue}for(c=[],S=[];l!==null&&l.k!==y;)(l.e.f&oe)===0&&(x??=new Set).add(l),S.push(l),l=l.next;if(l===null)continue;h=l}c.push(h),d=h,l=h.next}if(l!==null||x!==void 0){for(var Q=x===void 0?[]:Ne(x);l!==null;)(l.e.f&oe)===0&&Q.push(l),l=l.next;var re=Q.length;if(re>0){var p=null;gt(e,Q,p)}}a.first=e.first&&e.first.e,a.last=d&&d.e;for(var f of r.values())Ee(f.e);r.clear()}function Te(a,t,e,r){qe(a.v,t),a.i=e}function de(a,t,e,r,i,g,n,o,s,m,v){var $=(s&Ye)!==0,l=(s&Ke)===0,x=$?l?Ae(i,!1,!1):pe(i):i,d=(s&We)===0?n:pe(n),c={i:d,v:x,k:g,a:null,e:null,prev:e,next:r};try{if(a===null){var S=document.createDocumentFragment();S.append(a=ze())}return c.e=fe(()=>o(a,x,d,m),k),c.e.prev=e&&e.e,c.e.next=r&&r.e,e===null?v||(t.first=c):(e.next=c,e.e.next=c.e),r!==null&&(r.prev=c,r.e.prev=c.e),c}finally{}}function ue(a,t,e){for(var r=a.next?a.next.e.nodes_start:e,i=t?t.e.nodes_start:e,g=a.e.nodes_start;g!==null&&g!==r;){var n=Xe(g);i.before(g),g=n}}function F(a,t,e){t===null?a.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}function pt(a,t){return a==null?null:String(a)}function _t(a,t,e,r){var i=a.__style;if(k||i!==t){var g=pt(t);(!k||g!==a.getAttribute("style"))&&(g==null?a.removeAttribute("style"):a.style.cssText=g),a.__style=t}return r}const mt=Symbol("is custom element"),yt=Symbol("is html");function R(a,t,e,r){var i=xt(a);k&&(i[t]=a.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&a.nodeName==="LINK")||i[t]!==(i[t]=e)&&(t==="loading"&&(a[et]=e),e==null?a.removeAttribute(t):typeof e!="string"&&bt(a).includes(t)?a[t]=e:a.setAttribute(t,e))}function xt(a){return a.__attributes??={[mt]:a.nodeName.includes("-"),[yt]:a.namespaceURI===tt}}var be=new Map;function bt(a){var t=a.getAttribute("is")||a.nodeName,e=be.get(t);if(e)return e;be.set(t,e=[]);for(var r,i=a,g=Element.prototype;g!==i;){r=st(i);for(var n in r)r[n].set&&e.push(n);i=at(i)}return e}function St(a){if(!Array.isArray(a)||a.length!==3)return!1;const[t,e,r]=a;return!(typeof t!="number"||isNaN(t)||typeof e!="number"||isNaN(e)||typeof r!="number"||isNaN(r)||t<-90||t>90||e<-180||e>180||r<0||r>5e4)}function wt(a){let t=0;const e=[];for(const r of a)St(r)?e.push(r):t++;return{validPoints:e,errorCount:t}}const Se=24;function $t(){const{subscribe:a,set:t,update:e}=Ie({datasets:[],status:{loading:!1,error:null,lastUpdated:null}});let r=null;async function i(o){const s=o.toString().padStart(2,"0"),m=`/api/balloons?hour=${o}`;try{console.log(`[Store] Fetching balloon data from ${m}`);const v=await fetch(m);if(console.log(`[Store] Response status: ${v.status}`),!v.ok){const d=await v.text();return console.error(`Failed to fetch ${s}.json: ${v.status}`,d),null}const $=await v.json();if(console.log(`[Store] Received data for ${s}:`,$),!Array.isArray($))return console.warn(`Invalid data format for ${s}.json`),null;const{validPoints:l,errorCount:x}=wt($);return console.log(`Hour ${s}: ${l.length} valid points, ${x} errors filtered`),{hour:o,points:l,timestamp:new Date,errorCount:x}}catch(v){return console.error(`Error fetching ${s}.json:`,v),null}}async function g(){e(o=>({...o,status:{...o.status,loading:!0,error:null}}));try{const o=Array.from({length:Se},(v,$)=>$),m=(await Promise.all(o.map(v=>i(v)))).filter(v=>v!==null);e(v=>({datasets:m,status:{loading:!1,error:null,lastUpdated:new Date}})),console.log(`Successfully loaded ${m.length}/${Se} balloon datasets`)}catch(o){const s=o instanceof Error?o.message:"Unknown error";e(m=>({...m,status:{loading:!1,error:s,lastUpdated:null}}))}}function n(){return g(),r=window.setInterval(()=>{g()},120*1e3),()=>{r!==null&&(clearInterval(r),r=null)}}return{subscribe:a,fetchAll:g,startPolling:n}}const we=$t();function It(){const{subscribe:a,update:t}=Ie({satellites:[],status:{loading:!1,error:null,lastUpdated:null}});let e=null;function r(n){const o=n.trim().split(`
`);if(o.length<2)return[];const s=o[0].split(","),m=s.indexOf("latitude"),v=s.indexOf("longitude"),$=s.indexOf("brightness"),l=s.indexOf("confidence"),x=s.indexOf("acq_date"),d=s.indexOf("acq_time"),c=s.indexOf("satellite");if(m===-1||v===-1||$===-1||l===-1||x===-1||d===-1)return console.error("Missing required columns in satellite CSV"),[];const S=[];for(let M=1;M<o.length;M++){const y=o[M].split(",");if(y.length<s.length)continue;const h=parseFloat(y[m]),_=parseFloat(y[v]),w=parseFloat(y[$]),I=parseFloat(y[l]);isNaN(h)||isNaN(_)||isNaN(w)||isNaN(I)||S.push({latitude:h,longitude:_,brightness:w,confidence:I,acq_date:y[x],acq_time:y[d],satellite:c!==-1?y[c]:void 0})}return S}async function i(){t(n=>({...n,status:{...n.status,loading:!0,error:null}}));try{console.log("[Store] Fetching satellite data from /api/satellites");const n=await fetch("/api/satellites");if(console.log(`[Store] Satellite response status: ${n.status}`),!n.ok){const m=await n.text();throw console.error(`[Store] Satellite API error: ${n.status}`,m),new Error(`Satellite API returned ${n.status}`)}const o=await n.text();console.log(`[Store] Received CSV data, length: ${o.length}`);const s=r(o);console.log(`[Store] Parsed ${s.length} satellites from CSV`),t(()=>({satellites:s,status:{loading:!1,error:null,lastUpdated:new Date}})),console.log(`Successfully loaded ${s.length} satellite points`)}catch(n){const o=n instanceof Error?n.message:"Unknown error";console.error("Error fetching satellite data:",n),t(s=>({...s,status:{loading:!1,error:o,lastUpdated:null}}))}}function g(){return i(),e=window.setInterval(()=>{i()},180*1e3),()=>{e!==null&&(clearInterval(e),e=null)}}return{subscribe:a,fetchSatellites:i,startPolling:g}}const $e=It();var At=ve(`<meta name="description" content="Real-time artistic visualization of WindBorne's weather balloon constellation and orbital satellite network" class="svelte-1uha8ag"/>`),Nt=se('<g class="svelte-1uha8ag"><animateTransform attributeName="transform" type="translate" values="0,0; 1.25,0.9375; -0.9375,1.25; 0.9375,-1.25; 0,0" dur="12s" repeatCount="indefinite" calcMode="spline" keySplines="0.42,0 0.58,1; 0.42,0 0.58,1; 0.42,0 0.58,1; 0.42,0 0.58,1" class="svelte-1uha8ag"></animateTransform><circle fill="#3b82f6" class="data-point balloon-point svelte-1uha8ag" role="button" tabindex="0"></circle></g>'),Mt=se('<path fill="#FFD700" opacity="1" class="data-point satellite-point iss-point svelte-1uha8ag" role="button" tabindex="0"></path>'),Et=se('<circle fill="#dc2626" opacity="0.9" class="data-point satellite-point svelte-1uha8ag" role="button" tabindex="0"></circle>'),Tt=se('<g class="svelte-1uha8ag"><animateTransform attributeName="transform" type="translate" values="0,0; 1,0.75; -0.75,1; 0.75,-1; 0,0" dur="12s" repeatCount="indefinite" calcMode="spline" keySplines="0.42,0 0.58,1; 0.42,0 0.58,1; 0.42,0 0.58,1; 0.42,0 0.58,1" class="svelte-1uha8ag"></animateTransform><!></g>'),Dt=ve('<div class="tooltip svelte-1uha8ag"> </div>'),Bt=ve('<div class="fullscreen-container svelte-1uha8ag"><div class="map-wrapper svelte-1uha8ag"><svg class="map svelte-1uha8ag" viewBox="0 0 1000 600" preserveAspectRatio="none"><rect width="1000" height="600" fill="none" class="svelte-1uha8ag"></rect><!><!></svg></div> <div class="overlay-content svelte-1uha8ag"><h1 class="svelte-1uha8ag">WindBorne Weather Balloon & Satellite Live Imagery</h1> <div class="stats svelte-1uha8ag"><div class="svelte-1uha8ag"> </div> <div class="svelte-1uha8ag"> </div></div></div> <div class="footer svelte-1uha8ag"><div class="footer-left svelte-1uha8ag"><div class="credits svelte-1uha8ag"><div class="svelte-1uha8ag"><strong class="svelte-1uha8ag">Data Sources:</strong></div> <div class="svelte-1uha8ag">Weather Balloons: <a href="https://windbornesystems.com" target="_blank" rel="noopener noreferrer" class="svelte-1uha8ag">WindBorne Systems</a></div> <div class="svelte-1uha8ag">ISS: <a href="http://open-notify.org/Open-Notify-API/ISS-Location-Now/" target="_blank" rel="noopener noreferrer" class="svelte-1uha8ag">Open-Notify API</a></div> <div class="svelte-1uha8ag">Starlink Constellation: Generated orbital patterns</div></div></div> <div class="github-link svelte-1uha8ag"><a href="https://github.com/BrettEastman/windborne-weather" target="_blank" rel="noopener noreferrer" class="svelte-1uha8ag"><span class="svelte-1uha8ag">GitHub</span></a></div></div></div> <!>',1);function kt(a,t){rt(t,!1);const e=()=>xe(we,"$balloonData",i),r=()=>xe($e,"$satelliteData",i),[i,g]=dt();let n=null,o=null,s=Ae({visible:!1,x:0,y:0,content:""});Be(()=>{const p=()=>{};return window.addEventListener("resize",p),n=we.startPolling(),o=$e.startPolling(),()=>{window.removeEventListener("resize",p),n?.(),o?.()}});function m(p,f,b,T){const N=(f+180)/360*b,D=(90-p)/180*T;return{x:N,y:D}}function v(p,f){return(Math.sin(p*.01)*Math.cos(f*.01)+1)/2*2}function $(p){const f=Math.log(p+1),b=Math.log(50001);return 1+f/b*7}function l(p,f,b,T,N){const D=p.currentTarget.getBoundingClientRect();me(s,{visible:!0,x:D.left+D.width/2,y:D.top-10,content:`Lat: ${f.toFixed(2)}째 | Lon: ${b.toFixed(2)}째 | Alt: ${(T/1e3).toFixed(1)}km | Age: ${N}h`})}function x(p,f,b,T){const N=p.currentTarget.getBoundingClientRect();me(s,{visible:!0,x:N.left+N.width/2,y:N.top-10,content:`Lat: ${f.toFixed(2)}째 | Lon: ${b.toFixed(2)}째 | Brightness: ${T}`})}function d(){ft(s,u(s).visible=!1)}function c(p,f,b){const T=[];for(let N=0;N<10;N++){const D=N*Math.PI/5,L=N%2===0?b:b*.4,G=p+Math.cos(D-Math.PI/2)*L,K=f+Math.sin(D-Math.PI/2)*L;T.push(`${G},${K}`)}return`M${T.join(" L")} Z`}vt();var S=Bt();Le(p=>{var f=At();lt.title="WindBorne Weather Balloon & Satellite Live Imagery",U(p,f)});var M=_e(S),y=P(M),h=P(y),_=q(P(h));ce(_,1,()=>e().datasets,ie,(p,f)=>{var b=it(),T=_e(b);ce(T,1,()=>u(f).points,ie,(N,D)=>{var L=ct(()=>ut(u(D),3));let G=()=>u(L)[0],K=()=>u(L)[1],ae=()=>u(L)[2];const X=Y(()=>{const{x:ee,y:De}=m(G(),K(),1e3,600);return{x:ee,y:De}}),C=Y(()=>v(u(X).x,u(X).y));var A=Nt(),H=P(A),j=q(H);O(A),Z(ee=>{R(H,"begin",`${u(C)??""}s`),R(j,"cx",u(X).x),R(j,"cy",u(X).y),R(j,"r",ee),R(j,"opacity",1-u(f).hour/24)},[()=>$(ae())]),J("mouseenter",j,ee=>l(ee,G(),K(),ae(),u(f).hour)),J("mouseleave",j,d),U(N,A)}),U(p,b)});var w=q(_);ce(w,1,()=>r().satellites,ie,(p,f)=>{const b=Y(()=>{const{x:C,y:A}=m(u(f).latitude,u(f).longitude,1e3,600);return{x:C,y:A}}),T=Y(()=>u(f).brightness>350?8:4),N=Y(()=>v(u(b).x,u(b).y)),D=Y(()=>u(f).satellite==="ISS");var L=Tt(),G=P(L),K=q(G);{var ae=C=>{var A=Mt();Z(H=>R(A,"d",H),[()=>c(u(b).x,u(b).y,8)]),J("mouseenter",A,H=>x(H,u(f).latitude,u(f).longitude,u(f).brightness)),J("mouseleave",A,d),U(C,A)},X=C=>{var A=Et();Z(()=>{R(A,"cx",u(b).x),R(A,"cy",u(b).y),R(A,"r",u(T))}),J("mouseenter",A,H=>x(H,u(f).latitude,u(f).longitude,u(f).brightness)),J("mouseleave",A,d),U(C,A)};ye(K,C=>{u(D)?C(ae):C(X,!1)})}O(L),Z(()=>R(G,"begin",`${u(N)??""}s`)),U(p,L)}),O(h),O(y);var I=q(y,2),z=q(P(I),2),B=P(z),E=P(B);O(B);var V=q(B,2),W=P(V);O(V),O(z),O(I),ot(2),O(M);var Q=q(M,2);{var re=p=>{var f=Dt(),b=P(f,!0);O(f),Z(()=>{_t(f,`left: ${u(s).x??""}px; top: ${u(s).y??""}px`),ne(b,u(s).content)}),U(p,f)};ye(Q,p=>{u(s).visible&&p(re)})}Z(p=>{ne(E,`Balloons: ${p??""}`),ne(W,`Satellites: ${r().satellites.length??""}`)},[()=>e().datasets.reduce((p,f)=>p+f.points.length,0)]),U(a,S),nt(),g()}export{kt as component};
