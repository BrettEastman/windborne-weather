import"../chunks/DsnmJJEf.js";import"../chunks/B8C68kId.js";import{w as $e,o as Be,b as Le,a as re,e as J}from"../chunks/CBWahqQq.js";import{i as Oe,j as R,k as Ce,g as c,X as Y,l as Pe,H as ke,s as he,m as ge,n as le,x as te,ab as Fe,ac as Re,p as fe,t as He,q as Ue,ad as qe,o as ze,z as Ne,ae as pe,af as Ae,ag as We,ah as Ve,v as Me,w as Ge,ai as Ye,aj as Ke,ak as oe,al as Ee,am as Xe,an as je,ao as Je,ap as Ze,_ as Qe,aq as et,ar as tt,as as at,at as st,D as nt,F as ve,G as _e,I as Z,J as U,K as rt,L as C,au as lt,N as q,M as P,av as ot,O as it,aw as se,a9 as ut,ax as ct,B as me,ay as ft}from"../chunks/CGfr7eec.js";import{i as ye,s as dt,a as xe}from"../chunks/BZrhSzSA.js";import{i as vt}from"../chunks/OLJYdZL9.js";function ie(a,t){return t}function ht(a,t,e){for(var n=a.items,o=[],d=t.length,r=0;r<d;r++)je(t[r].e,o,!0);var i=d>0&&o.length===0&&e!==null;if(i){var s=e.parentNode;Je(s),s.append(e),n.clear(),F(a,t[0].prev,t[d-1].next)}Ze(o,()=>{for(var y=0;y<d;y++){var h=t[y];i||(n.delete(h.k),F(a,h.prev,h.next)),Ee(h.e,!i)}})}function ue(a,t,e,n,o,d=null){var r=a,i={flags:t,items:new Map,first:null};R&&Ce();var s=null,y=!1,h=new Map,N=Y(()=>{var u=e();return We(u)?u:u==null?[]:Ae(u)}),l,x;function v(){gt(x,l,i,h,r,o,t,n,e),d!==null&&(l.length===0?s?Me(s):s=fe(()=>d(r)):s!==null&&Ge(s,()=>{s=null}))}Oe(()=>{x??=Qe,l=c(N);var u=l.length;if(y&&u===0)return;y=u===0;let w=!1;if(R){var M=Pe(r)===ke;M!==(u===0)&&(r=he(),ge(r),le(!1),w=!0)}if(R){for(var m=null,g,_=0;_<u;_++){if(te.nodeType===Fe&&te.data===Re){r=te,w=!0,le(!1);break}var S=l[_],I=n(S,_);g=de(te,i,m,null,S,I,_,o,t,e),i.items.set(I,g),m=g}u>0&&ge(he())}if(R)u===0&&d&&(s=fe(()=>d(r)));else if(He()){var z=new Set,B=Ue;for(_=0;_<u;_+=1){S=l[_],I=n(S,_);var E=i.items.get(I)??h.get(I);E?Te(E,S,_):(g=de(null,i,null,null,S,I,_,o,t,e,!0),h.set(I,g)),z.add(I)}for(const[W,V]of i.items)z.has(W)||B.skipped_effects.add(V.e);B.add_callback(v)}else v();w&&le(!0),c(N)}),R&&(r=te)}function gt(a,t,e,n,o,d,r,i,s){var y=t.length,h=e.items,N=e.first,l=N,x,v=null,u=[],w=[],M,m,g,_;for(_=0;_<y;_+=1){if(M=t[_],m=i(M,_),g=h.get(m),g===void 0){var S=n.get(m);if(S!==void 0){n.delete(m),h.set(m,S);var I=v?v.next:l;F(e,v,S),F(e,S,I),ce(S,I,o),v=S}else{var z=l?l.e.nodes_start:o;v=de(z,e,v,v===null?e.first:v.next,M,m,_,d,r,s)}h.set(m,v),u=[],w=[],l=v.next;continue}if(Te(g,M,_),(g.e.f&oe)!==0&&Me(g.e),g!==l){if(x!==void 0&&x.has(g)){if(u.length<w.length){var B=w[0],E;v=B.prev;var W=u[0],V=u[u.length-1];for(E=0;E<u.length;E+=1)ce(u[E],B,o);for(E=0;E<w.length;E+=1)x.delete(w[E]);F(e,W.prev,V.next),F(e,v,W),F(e,V,B),l=B,v=V,_-=1,u=[],w=[]}else x.delete(g),ce(g,l,o),F(e,g.prev,g.next),F(e,g,v===null?e.first:v.next),F(e,v,g),v=g;continue}for(u=[],w=[];l!==null&&l.k!==m;)(l.e.f&oe)===0&&(x??=new Set).add(l),w.push(l),l=l.next;if(l===null)continue;g=l}u.push(g),v=g,l=g.next}if(l!==null||x!==void 0){for(var Q=x===void 0?[]:Ae(x);l!==null;)(l.e.f&oe)===0&&Q.push(l),l=l.next;var ne=Q.length;if(ne>0){var p=null;ht(e,Q,p)}}a.first=e.first&&e.first.e,a.last=v&&v.e;for(var f of n.values())Ee(f.e);n.clear()}function Te(a,t,e,n){qe(a.v,t),a.i=e}function de(a,t,e,n,o,d,r,i,s,y,h){var N=(s&Ye)!==0,l=(s&Ke)===0,x=N?l?Ne(o,!1,!1):pe(o):o,v=(s&Ve)===0?r:pe(r),u={i:v,v:x,k:d,a:null,e:null,prev:e,next:n};try{if(a===null){var w=document.createDocumentFragment();w.append(a=ze())}return u.e=fe(()=>i(a,x,v,y),R),u.e.prev=e&&e.e,u.e.next=n&&n.e,e===null?h||(t.first=u):(e.next=u,e.e.next=u.e),n!==null&&(n.prev=u,n.e.prev=u.e),u}finally{}}function ce(a,t,e){for(var n=a.next?a.next.e.nodes_start:e,o=t?t.e.nodes_start:e,d=a.e.nodes_start;d!==null&&d!==n;){var r=Xe(d);o.before(d),d=r}}function F(a,t,e){t===null?a.first=e:(t.next=e,t.e.next=e&&e.e),e!==null&&(e.prev=t,e.e.prev=t&&t.e)}function pt(a,t){return a==null?null:String(a)}function _t(a,t,e,n){var o=a.__style;if(R||o!==t){var d=pt(t);(!R||d!==a.getAttribute("style"))&&(d==null?a.removeAttribute("style"):a.style.cssText=d),a.__style=t}return n}const mt=Symbol("is custom element"),yt=Symbol("is html");function k(a,t,e,n){var o=xt(a);R&&(o[t]=a.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&a.nodeName==="LINK")||o[t]!==(o[t]=e)&&(t==="loading"&&(a[et]=e),e==null?a.removeAttribute(t):typeof e!="string"&&bt(a).includes(t)?a[t]=e:a.setAttribute(t,e))}function xt(a){return a.__attributes??={[mt]:a.nodeName.includes("-"),[yt]:a.namespaceURI===tt}}var be=new Map;function bt(a){var t=a.getAttribute("is")||a.nodeName,e=be.get(t);if(e)return e;be.set(t,e=[]);for(var n,o=a,d=Element.prototype;d!==o;){n=st(o);for(var r in n)n[r].set&&e.push(r);o=at(o)}return e}function wt(a){if(!Array.isArray(a)||a.length!==3)return!1;const[t,e,n]=a;return!(typeof t!="number"||isNaN(t)||typeof e!="number"||isNaN(e)||typeof n!="number"||isNaN(n)||t<-90||t>90||e<-180||e>180||n<0||n>5e4)}function St(a){let t=0;const e=[];for(const n of a)wt(n)?e.push(n):t++;return{validPoints:e,errorCount:t}}const we=24;function It(){const{subscribe:a,set:t,update:e}=$e({datasets:[],status:{loading:!1,error:null,lastUpdated:null}});let n=null;async function o(i){const s=i.toString().padStart(2,"0"),y=`/api/balloons?hour=${i}`;try{const h=await fetch(y);if(!h.ok)return console.warn(`Failed to fetch ${s}.json: ${h.status}`),null;const N=await h.json();if(!Array.isArray(N))return console.warn(`Invalid data format for ${s}.json`),null;const{validPoints:l,errorCount:x}=St(N);return console.log(`Hour ${s}: ${l.length} valid points, ${x} errors filtered`),{hour:i,points:l,timestamp:new Date,errorCount:x}}catch(h){return console.error(`Error fetching ${s}.json:`,h),null}}async function d(){e(i=>({...i,status:{...i.status,loading:!0,error:null}}));try{const i=Array.from({length:we},(h,N)=>N),y=(await Promise.all(i.map(h=>o(h)))).filter(h=>h!==null);e(h=>({datasets:y,status:{loading:!1,error:null,lastUpdated:new Date}})),console.log(`Successfully loaded ${y.length}/${we} balloon datasets`)}catch(i){const s=i instanceof Error?i.message:"Unknown error";e(y=>({...y,status:{loading:!1,error:s,lastUpdated:null}}))}}function r(){return d(),n=window.setInterval(()=>{d()},120*1e3),()=>{n!==null&&(clearInterval(n),n=null)}}return{subscribe:a,fetchAll:d,startPolling:r}}const Se=It();function $t(){const{subscribe:a,update:t}=$e({satellites:[],status:{loading:!1,error:null,lastUpdated:null}});let e=null;function n(r){const i=r.trim().split(`
`);if(i.length<2)return[];const s=i[0].split(","),y=s.indexOf("latitude"),h=s.indexOf("longitude"),N=s.indexOf("brightness"),l=s.indexOf("confidence"),x=s.indexOf("acq_date"),v=s.indexOf("acq_time"),u=s.indexOf("satellite");if(y===-1||h===-1||N===-1||l===-1||x===-1||v===-1)return console.error("Missing required columns in satellite CSV"),[];const w=[];for(let M=1;M<i.length;M++){const m=i[M].split(",");if(m.length<s.length)continue;const g=parseFloat(m[y]),_=parseFloat(m[h]),S=parseFloat(m[N]),I=parseFloat(m[l]);isNaN(g)||isNaN(_)||isNaN(S)||isNaN(I)||w.push({latitude:g,longitude:_,brightness:S,confidence:I,acq_date:m[x],acq_time:m[v],satellite:u!==-1?m[u]:void 0})}return w}async function o(){t(r=>({...r,status:{...r.status,loading:!0,error:null}}));try{const r=await fetch("/api/satellites");if(!r.ok)throw new Error(`Satellite API returned ${r.status}`);const i=await r.text(),s=n(i);t(()=>({satellites:s,status:{loading:!1,error:null,lastUpdated:new Date}})),console.log(`Successfully loaded ${s.length} satellite points`)}catch(r){const i=r instanceof Error?r.message:"Unknown error";console.error("Error fetching satellite data:",r),t(s=>({...s,status:{loading:!1,error:i,lastUpdated:null}}))}}function d(){return o(),e=window.setInterval(()=>{o()},180*1e3),()=>{e!==null&&(clearInterval(e),e=null)}}return{subscribe:a,fetchSatellites:o,startPolling:d}}const Ie=$t();var Nt=ve(`<meta name="description" content="Real-time artistic visualization of WindBorne's weather balloon constellation and orbital satellite network" class="svelte-1uha8ag"/>`),At=se('<g class="svelte-1uha8ag"><animateTransform attributeName="transform" type="translate" values="0,0; 1.25,0.9375; -0.9375,1.25; 0.9375,-1.25; 0,0" dur="12s" repeatCount="indefinite" calcMode="spline" keySplines="0.42,0 0.58,1; 0.42,0 0.58,1; 0.42,0 0.58,1; 0.42,0 0.58,1" class="svelte-1uha8ag"></animateTransform><circle fill="#3b82f6" class="data-point balloon-point svelte-1uha8ag" role="button" tabindex="0"></circle></g>'),Mt=se('<path fill="#FFD700" opacity="1" class="data-point satellite-point iss-point svelte-1uha8ag" role="button" tabindex="0"></path>'),Et=se('<circle fill="#dc2626" opacity="0.9" class="data-point satellite-point svelte-1uha8ag" role="button" tabindex="0"></circle>'),Tt=se('<g class="svelte-1uha8ag"><animateTransform attributeName="transform" type="translate" values="0,0; 1,0.75; -0.75,1; 0.75,-1; 0,0" dur="12s" repeatCount="indefinite" calcMode="spline" keySplines="0.42,0 0.58,1; 0.42,0 0.58,1; 0.42,0 0.58,1; 0.42,0 0.58,1" class="svelte-1uha8ag"></animateTransform><!></g>'),Dt=ve('<div class="tooltip svelte-1uha8ag"> </div>'),Bt=ve('<div class="fullscreen-container svelte-1uha8ag"><div class="map-wrapper svelte-1uha8ag"><svg class="map svelte-1uha8ag" viewBox="0 0 1000 600" preserveAspectRatio="none"><rect width="1000" height="600" fill="none" class="svelte-1uha8ag"></rect><!><!></svg></div> <div class="overlay-content svelte-1uha8ag"><h1 class="svelte-1uha8ag">WindBorne Weather Balloon & Satellite Live Imagery</h1> <div class="stats svelte-1uha8ag"><div class="svelte-1uha8ag"> </div> <div class="svelte-1uha8ag"> </div></div></div> <div class="footer svelte-1uha8ag"><div class="footer-left svelte-1uha8ag"><div class="credits svelte-1uha8ag"><div class="svelte-1uha8ag"><strong class="svelte-1uha8ag">Data Sources:</strong></div> <div class="svelte-1uha8ag">Weather Balloons: <a href="https://windbornesystems.com" target="_blank" rel="noopener noreferrer" class="svelte-1uha8ag">WindBorne Systems</a></div> <div class="svelte-1uha8ag">ISS: <a href="http://open-notify.org/Open-Notify-API/ISS-Location-Now/" target="_blank" rel="noopener noreferrer" class="svelte-1uha8ag">Open-Notify API</a></div> <div class="svelte-1uha8ag">Starlink Constellation: Generated orbital patterns</div></div></div> <div class="github-link svelte-1uha8ag"><a href="https://github.com/BrettEastman/windborne-weather" target="_blank" rel="noopener noreferrer" class="svelte-1uha8ag"><span class="svelte-1uha8ag">GitHub</span></a></div></div></div> <!>',1);function Rt(a,t){nt(t,!1);const e=()=>xe(Se,"$balloonData",o),n=()=>xe(Ie,"$satelliteData",o),[o,d]=dt();let r=null,i=null,s=Ne({visible:!1,x:0,y:0,content:""});Be(()=>{const p=()=>{};return window.addEventListener("resize",p),r=Se.startPolling(),i=Ie.startPolling(),()=>{window.removeEventListener("resize",p),r?.(),i?.()}});function y(p,f,b,T){const A=(f+180)/360*b,D=(90-p)/180*T;return{x:A,y:D}}function h(p,f){return(Math.sin(p*.01)*Math.cos(f*.01)+1)/2*2}function N(p){const f=Math.log(p+1),b=Math.log(50001);return 1+f/b*7}function l(p,f,b,T,A){const D=p.currentTarget.getBoundingClientRect();me(s,{visible:!0,x:D.left+D.width/2,y:D.top-10,content:`Lat: ${f.toFixed(2)}째 | Lon: ${b.toFixed(2)}째 | Alt: ${(T/1e3).toFixed(1)}km | Age: ${A}h`})}function x(p,f,b,T){const A=p.currentTarget.getBoundingClientRect();me(s,{visible:!0,x:A.left+A.width/2,y:A.top-10,content:`Lat: ${f.toFixed(2)}째 | Lon: ${b.toFixed(2)}째 | Brightness: ${T}`})}function v(){ft(s,c(s).visible=!1)}function u(p,f,b){const T=[];for(let A=0;A<10;A++){const D=A*Math.PI/5,L=A%2===0?b:b*.4,G=p+Math.cos(D-Math.PI/2)*L,K=f+Math.sin(D-Math.PI/2)*L;T.push(`${G},${K}`)}return`M${T.join(" L")} Z`}vt();var w=Bt();Le(p=>{var f=Nt();lt.title="WindBorne Weather Balloon & Satellite Live Imagery",U(p,f)});var M=_e(w),m=C(M),g=C(m),_=q(C(g));ue(_,1,()=>e().datasets,ie,(p,f)=>{var b=it(),T=_e(b);ue(T,1,()=>c(f).points,ie,(A,D)=>{var L=ut(()=>ct(c(D),3));let G=()=>c(L)[0],K=()=>c(L)[1],ae=()=>c(L)[2];const X=Y(()=>{const{x:ee,y:De}=y(G(),K(),1e3,600);return{x:ee,y:De}}),O=Y(()=>h(c(X).x,c(X).y));var $=At(),H=C($),j=q(H);P($),Z(ee=>{k(H,"begin",`${c(O)??""}s`),k(j,"cx",c(X).x),k(j,"cy",c(X).y),k(j,"r",ee),k(j,"opacity",1-c(f).hour/24)},[()=>N(ae())]),J("mouseenter",j,ee=>l(ee,G(),K(),ae(),c(f).hour)),J("mouseleave",j,v),U(A,$)}),U(p,b)});var S=q(_);ue(S,1,()=>n().satellites,ie,(p,f)=>{const b=Y(()=>{const{x:O,y:$}=y(c(f).latitude,c(f).longitude,1e3,600);return{x:O,y:$}}),T=Y(()=>c(f).brightness>350?8:4),A=Y(()=>h(c(b).x,c(b).y)),D=Y(()=>c(f).satellite==="ISS");var L=Tt(),G=C(L),K=q(G);{var ae=O=>{var $=Mt();Z(H=>k($,"d",H),[()=>u(c(b).x,c(b).y,8)]),J("mouseenter",$,H=>x(H,c(f).latitude,c(f).longitude,c(f).brightness)),J("mouseleave",$,v),U(O,$)},X=O=>{var $=Et();Z(()=>{k($,"cx",c(b).x),k($,"cy",c(b).y),k($,"r",c(T))}),J("mouseenter",$,H=>x(H,c(f).latitude,c(f).longitude,c(f).brightness)),J("mouseleave",$,v),U(O,$)};ye(K,O=>{c(D)?O(ae):O(X,!1)})}P(L),Z(()=>k(G,"begin",`${c(A)??""}s`)),U(p,L)}),P(g),P(m);var I=q(m,2),z=q(C(I),2),B=C(z),E=C(B);P(B);var W=q(B,2),V=C(W);P(W),P(z),P(I),ot(2),P(M);var Q=q(M,2);{var ne=p=>{var f=Dt(),b=C(f,!0);P(f),Z(()=>{_t(f,`left: ${c(s).x??""}px; top: ${c(s).y??""}px`),re(b,c(s).content)}),U(p,f)};ye(Q,p=>{c(s).visible&&p(ne)})}Z(p=>{re(E,`Balloons: ${p??""}`),re(V,`Satellites: ${n().satellites.length??""}`)},[()=>e().datasets.reduce((p,f)=>p+f.points.length,0)]),U(a,w),rt(),d()}export{Rt as component};
